<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MemoryGame</title>
    <link rel="stylesheet" href="memory.css">
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>
</head>
<body>

<div id="app"></div>
<script type="text/babel">

    function shuffleArray(array) {
        let i = array.length - 1;
        for (; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            const temp = array[i];
            array[i] = array[j];
            array[j] = temp;
        }
        return array;
    }

    class Card extends React.Component {
        constructor(props) {
            super(props);
        }

        render() {
            const {color, id, showCard, covered} = this.props;
            const cardCovered = {
                transition: "all 0.5s",
                opacity: "1",
                backgroundColor: "grey",
                width: "120px",
                height: "120px",
                margin: "8px",
                float: "left",
                borderRadius: "25px",
                border: "4px solid grey"
            };
            const cardUncovered = {
                transition: "all 0.5s",
                opacity: "1",
                backgroundColor: this.props.color,
                width: "120px",
                height: "120px",
                margin: "8px",
                float: "left",
                borderRadius: "25px",
                border: "4px solid grey"
            };
            return (
                <div style={(this.props.covered) ? cardCovered : cardUncovered} onClick={() => showCard(id)}> </div>
            )
        }
    }

    class CardsList extends React.Component {
        render() {
            const {showCard} = this.props;
            const cards = this.props.cards.map((c, index) => (
                <Card key={index} {...c} showCard={showCard}/>
            ));
            return (
                <div>{cards}</div>
            )
        }
    }

    class Navbar extends React.Component {
        static defaultProps = {
            newGame() {
            }
        };

        render() {
            const {newGame} = this.props;
            return (
                <div className="topnav">
                    <h2><a className="active">Memory Game</a></h2>
                    <a onClick={() => newGame()} href="#">New Game </a>
                </div>
            )
        }
    }

    class Memory extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                cards: [{id: 0, color: "blue", covered: true}, {id: 1, color: "red", covered: true}, {id: 2, color: "yellow", covered: true},
                    {id: 3, color: "pink", covered: true}, {id: 4, color: "blue", covered: true}, {id: 5, color: "red", covered: true},
                    {id: 6, color: "yellow", covered: true}, {id: 7, color: "pink", covered: true}, {id: 8, color: "purple", covered: true},
                    {id: 9, color: "black", covered: true}, {id: 10, color: "white", covered: true}, {id: 11, color: "orange", covered: true},
                    {id: 12, color: "purple", covered: true}, {id: 13, color: "black", covered: true}, {id: 14, color: "white", covered: true},
                    {id: 15, color: "orange", covered: true}],
                firstCard: {}
            };
            this.showCard = this.showCard.bind(this);
            this.newGame = this.newGame.bind(this);
            this.handleFirstCardAndCheck = this.handleFirstCardAndCheck.bind(this);
        }

        showCard(id) {
            const cardsCopy = this.state.cards.slice(0);
            this.handleFirstCardAndCheck(cardsCopy[id]);
            cardsCopy[id].covered = false;
            this.setState({cards: cardsCopy});
        }

        handleFirstCardAndCheck(card){
            if (card.covered === true){
                if (this.state.firstCard.color === undefined) {
                    this.setState({firstCard: card});

                } else {
                    setTimeout(function () {
                        if (this.state.firstCard.color !== card.color) {
                            card.covered = true;
                            let firstClickedCard = this.state.firstCard;
                            firstClickedCard.covered = true;
                            const cards2 = this.state.cards.map((c, i) => (
                                i === firstClickedCard.id ? firstClickedCard : c
                            ));
                            this.setState({cards: cards2});
                        }
                        this.setState({firstCard: {}});
                    }.bind(this), 800);
                }
            }
        }
        newGame() {
            const cardsShuffled = shuffleArray(this.state.cards);
            for (let i =0; i<cardsShuffled.length; i++){
                cardsShuffled[i].id= i;
                cardsShuffled[i].covered= true;
            }
            this.setState({firstCard: {}});
            this.setState({cards: cardsShuffled});
            console.log("newGame");
        }

        componentDidMount() {
            this.newGame();
        }

        render() {
            return (
                <div>
                    <Navbar newGame={this.newGame}/>
                    < div className = "content"><CardsList showCard={this.showCard} cards={this.state.cards}/></div>
                </div>
            )
        }
    }

    ReactDOM.render(<Memory/>, document.getElementById("app"));
</script>
</body>
</html>